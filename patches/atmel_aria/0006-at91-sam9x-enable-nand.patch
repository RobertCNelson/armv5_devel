From 38bc422c020c19813df7bee014362cb306bca690 Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Tue, 4 Dec 2012 14:17:46 -0600
Subject: [PATCH 6/6] at91: sam9x: enable nand

reference: http://lists.infradead.org/pipermail/linux-arm-kernel/2012-December/135973.html

debian@arm:~$ dmesg | grep -i nand
[    0.691406] atmel_nand: Use On Flash BBT
[    0.695312] atmel_nand 40000000.nand: No DMA support for NAND access.
[    0.703125] No NAND device found

Signed-off-by: Robert Nelson <robertcnelson@gmail.com>
---
 arch/arm/boot/dts/at91sam9x5cm.dtsi |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/arch/arm/boot/dts/at91sam9x5cm.dtsi b/arch/arm/boot/dts/at91sam9x5cm.dtsi
index 31e7be2..e333495 100644
--- a/arch/arm/boot/dts/at91sam9x5cm.dtsi
+++ b/arch/arm/boot/dts/at91sam9x5cm.dtsi
@@ -26,7 +26,11 @@
 	ahb {
 		nand0: nand@40000000 {
 			nand-bus-width = <8>;
-			nand-ecc-mode = "soft";
+			nand-ecc-mode = "hw";
+			atmel,has-pmecc;		/* Enable PMECC */
+			atmel,pmecc-cap = <2>;		/* PMECC error bits*/
+			atmel,pmecc-sector-size = <512>;	/* sector size for PMECC, it is not page size */
+			atmel,pmecc-lookup-table-offset = <0x8000 0x10000>;
 			nand-on-flash-bbt;
 			status = "okay";
 
-- 
1.7.10.4

